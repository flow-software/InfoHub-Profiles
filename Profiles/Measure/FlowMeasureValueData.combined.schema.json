{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "FlowMeasureValueData.combined.schema.json",
  "title": "Flow Measure Value Data (Combined)",
  "description": "Profile — Complete self-contained schema for measure value data payloads. One message is published per time period with all measure values aggregated into the values array. Each sub-section includes its own $comment and $namespace for composable profile referencing.",
  "type": "object",
  "properties": {
    "$comment": {
      "type": "string",
      "const": "Flow Software CESMII SM Profile - Measure Value Data"
    },
    "$namespace": {
      "type": "string",
      "description": "Root profile namespace URI ({profileUri}/MeasureValueData)"
    },
    "measure": {
      "type": "object",
      "description": "Measure identification — identifies the measure being reported",
      "properties": {
        "$comment": {
          "type": "string",
          "const": "Measure definition — identifies the measure being reported"
        },
        "$namespace": {
          "type": "string",
          "description": "Profile namespace URI ({profileUri}/Measure)"
        },
        "name": {
          "type": "string",
          "description": "The name of the measure"
        },
        "id": {
          "type": "integer",
          "description": "Unique identifier for the measure"
        },
        "uom": {
          "type": "string",
          "description": "Unit of measure (e.g. kWh, MW, degC)"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the measure"
        },
        "intervalType": {
          "type": "string",
          "description": "The interval type (e.g. Hourly, Daily, Monthly, Tag, Timestamp)"
        },
        "hierarchicalName": {
          "type": "string",
          "description": "Fully qualified hierarchical name (e.g. Parent.Child.MeasureName)"
        },
        "parent": {
          "type": "string",
          "description": "Parent node name in the data model hierarchy"
        },
        "format": {
          "type": "string",
          "description": "Display format string for the measure value"
        },
        "measureDataApiEndpoint": {
          "type": "string",
          "format": "uri",
          "description": "API endpoint URL to retrieve measure data (without attributes)"
        },
        "measureDataApiEndpointWithAttributes": {
          "type": "string",
          "format": "uri",
          "description": "API endpoint URL to retrieve measure data (with attributes)"
        }
      },
      "required": ["$namespace", "name", "id"]
    },
    "timePeriod": {
      "type": "object",
      "description": "Time period — defines the reporting window for the values",
      "properties": {
        "$comment": {
          "type": "string",
          "const": "Time period — defines the reporting window for the values"
        },
        "$namespace": {
          "type": "string",
          "description": "Profile namespace URI ({profileUri}/TimePeriod)"
        },
        "start": {
          "type": "string",
          "format": "date-time",
          "description": "Period start in ISO 8601 format (UTC)"
        },
        "end": {
          "type": "string",
          "format": "date-time",
          "description": "Period end in ISO 8601 format (UTC)"
        },
        "startUnix": {
          "type": "integer",
          "description": "Period start as Unix timestamp (seconds since epoch)"
        },
        "endUnix": {
          "type": "integer",
          "description": "Period end as Unix timestamp (seconds since epoch)"
        },
        "timeScheme": {
          "type": "string",
          "description": "Time scheme name (e.g. Calendar, Fiscal)"
        },
        "timeSchemeShift": {
          "type": ["string", "null"],
          "description": "Time scheme shift identifier"
        }
      },
      "required": ["$namespace", "start", "end"]
    },
    "values": {
      "type": "array",
      "description": "Array of all preferred measure values for this time period, each with optional attribute breakdown",
      "items": {
        "type": "object",
        "description": "A single measure value data point",
        "properties": {
          "$comment": {
            "type": "string",
            "const": "Measure value — a single data point with optional attribute breakdown"
          },
          "$namespace": {
            "type": "string",
            "description": "Profile namespace URI ({profileUri}/MeasureValue)"
          },
          "value": {
            "type": ["number", "null"],
            "description": "The numeric measure value"
          },
          "quality": {
            "type": "integer",
            "description": "OPC quality code for the value (e.g. 192 = Good)"
          },
          "formattedValue": {
            "type": "string",
            "description": "The measure value formatted according to the measure's display format"
          },
          "duration": {
            "type": "number",
            "description": "Duration associated with this value (in seconds)"
          },
          "attribute": {
            "type": "string",
            "description": "Event attribute name (present only when event attributes exist)"
          },
          "attributeValue": {
            "type": "string",
            "description": "Event attribute value (present only when event attributes exist)"
          }
        },
        "required": ["$namespace", "value", "quality"]
      }
    },
    "modelAttributes": {
      "type": "object",
      "description": "Model attributes — contextual metadata from the data model hierarchy. Omitted when no model attributes exist.",
      "properties": {
        "$comment": {
          "type": "string",
          "const": "Model attributes — contextual metadata from the data model hierarchy"
        },
        "$namespace": {
          "type": "string",
          "description": "Profile namespace URI ({profileUri}/ModelAttributes)"
        }
      },
      "additionalProperties": {
        "type": "string",
        "description": "Model attribute value — key is the attribute name"
      },
      "required": ["$namespace"]
    }
  },
  "required": ["$namespace", "measure", "timePeriod", "values"]
}
